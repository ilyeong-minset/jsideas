<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>연관규칙 분석사례 - 대하드라마 정도전</title>
  <meta name="description" content="a novice's journey into data science
" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="canonical" href="http://localhost:4000/r/2015/05/03/jdj-association-analysis.html">

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
<!--  <link rel="stylesheet" href=""> -->
  <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
</head>

  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->

<a href="http://localhost:4000" class="logo-readium"><span class="logo" style="background-image: url(/assets/images/df_logo.jpg)"></span></a>

<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">연관규칙 분석사례 - 대하드라마 정도전</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Jun</h4>
              on
              <time datetime="2015-05-03T08:50:00+09:00">03 May 2015</time>
              <!-- , tagged on <span class="post-tag-">, <a href="/tag/"></a></span> -->
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <h2 class="section-heading">연관규칙 분석사례 - 대하드라마 정도전</h2>

<p>association analysis case - Jeong Do Jeon, a Korean history drama</p>

<p>그림 출처: http://starplanet.tistory.com/1872 </p>

<p>요즘 패스트캠퍼스에서 진행하는 머신러닝 강의를 듣고 있는데, 지난주 수요일에 들었던 강의는 R의 ‘arules’ 라이브러리를 활용한 ‘연관규칙 분석’입니다. 여러가지 변수간의 공통출현빈도를 계산해서 상관관계의 rule을 도출해내는 분석 방법인데, 수업을 듣던 도중 작년 여름에 했던 <a href="http://www.slideshare.net/jdjmania/jdj-network-analysisvf">대하드라마 정도전 네트워크 분석</a>이 생각났습니다.</p>

<p>당시 드라마를 보면서 같은 장면에 등장한 인물들의 목록을 데이터화했고 python의 ‘networkx’라이브러리와 gephi를 통해 분석을 했습니다. 연관규칙분석을 몰랐던 당시에는 3인 이상의 대화 장면을 각 인물간의 1:1 교류(all possible unique pair)로 변환한 후에, 최다 대화빈도, 최다 교류빈도 등과 같은 차트를 만들었었습니다.</p>

<p>R을 사용하여 연관규칙분석을 돌리면 첫번째는 교류로 변환하는 과정이 필요없고, 두번째는 support, confidence, lift를 활용한 ‘규칙’ 도출이 가능합니다. 그래서 이번에는 같은 데이터를 R을 통해 연관규칙 분석해보았습니다.</p>

<h2 class="section-heading">0. 분석 방법</h2>

<p>각 회별로 정리된 인물데이터 csv파일을 불러온 후 모두 합쳐 50회 분량의 데이터를 하나의 리스트에 저장했습니다. 저장한 리스트를 R의 transactions 데이터 타입으로 변환하고 중간에 실수로 들어갔던 중복(duplicates)을 처리했습니다. 그리고 앞서 소개한 ‘arules’라이브러리와 시각화를 위한 ‘arulesViz’, ‘wordcloud’를 사용하여 워드클라우드와 빈도플롯을 그려보았습니다. 마지막으로는 support와 confidence값을 조정하여 규칙 리스트를 뽑아낸 후, lift가 높은 순으로 규칙 5개를 뽑았습니다.</p>

<h2 class="section-heading">1. 워드클라우드</h2>

<p><img src="/assets/jdj/pic1.png" alt="pic1">
<span class="caption text-muted">fig 1. wordcloud</span></p>

<p>워드클라우드는 등장 빈도와 같은 값에 비례하여 해당 단어나 변수의 크기와 색을 글자뭉치형태로 보여주는 그림입니다. 여기서는 각 인물들의 등장 빈도를 기반으로 그림을 구성하였고, 등장빈도가 유사하면 같은 색으로 처리되었습니다. mac에서 RStudio로 작업을 하였는데, 한글을 AppleGothic으로 처리하였더니 그래픽이 예쁘지는 않습니다. (폰트 지정을 아예 안해주면 네모칸으로 표시됩니다ㅠㅠ) 당연하게 정도전이 가장 크게 나오지만, 정도전이 보좌하는 이성계도 만만치 않은 등장빈도를 자랑합니다. 정도전의 숙적으로 나왔던 정몽주, 이방원, 이인임도 보이네요. 극 초반 포스를 보여줬던 공민왕은 저 멀리 구석에서 발견됩니다.
</p>

<h2 class="section-heading">2. 등장빈도 분석</h2>

<p><img src="/assets/jdj/pic2.png" alt="pic2">
<span class="caption text-muted">fig 2. itemFrequencyPlot</span></p>

<p>두번째는 인물들의 등장빈도 차트입니다. 여기서는 support를 0.05로 잡고 차트를 뽑았습니다. 결과는 앞선 워드클라우드를 바차트로 표현한 것과 동일합니다. 다만 support로 threshold를 주었기에 보수주인같은 비주요 등장인물들은 나오지 않습니다.</p>

<h2 class="section-heading">3. 연관규칙 도출</h2>

<p>이제 연관규칙 분석의 핵심인 ‘규칙’을 뽑을 차례입니다. 규칙은 3가지 지표를 통해 도출하는데 이들은 앞서 언급했던 support, cofidence, 그리고 lift입니다. support는 조건절이 일어날 확률, confidence는 조건절이 일어났을 때 결과절이 일어날 확률, 그리고 lift는 조건절과 결과절의 발생이 서로 독립이 아닐 확률(이 경우 독립 확률인 1보다 커야함)입니다. </p>

<p>apriori 함수를 사용할 때 support를 최소 0.025 이상, confidence를 최소 0.5 이상으로 잡고 규칙을 뽑았습니다. 총 25개 규칙이 나왔네요. (support와 confidence를 설정하는데는 정해진 답은 없다고 합니다. 데이터의 성격에 맞게 돌리는 것인데, 대략 20~40개 정도가 나오면 적정하다고 합니다.)</p>

<p><img src="/assets/jdj/pic3.png" alt="pic3"></p>

<p>자 그러면 여기서 lift (조건절과 결과절이 독립이 아닐 확률, 즉 서로 강한 영향을 주고 받을 확률. 1보다 높아야 함)를 기준으로 상위 5개를 뽑아보겠습니다.</p>

<p><img src="/assets/jdj/pic4.png" alt="pic4">
<span class="caption text-muted">fig 3. rules</span></p>

<p>규칙은 5개가 나왔지만, 정리하면 크게 3가지로 나뉘어지네요.</br>
1. 이숭인, 권근</br>
2. 배극렴, 이성계, 변안열</br>
3. 염흥방, 임견미</br>
</p>

<p>이 3커플(?)은 극에서 가장 중요한 커플들은 아니었습니다만, 생각해보면 서로 함께 많이 나오던 사람들이기는 합니다. 이숭인과 권근은 신진사대부 세력으로 초반에 정몽주를 도와 이인임과 싸우다가 나중에는 정도전과 싸웁니다. 배극렴, 이성계, 변안열은 드라마 중반 침략한 왜구들을 맞아 함께 싸우는 장면이 많이 등장합니다. 마지막으로 염흥방과 임견미는 이인임의 수족으로 함께 전횡을 일삼는 탐관오리 커플로 그려집니다.</p>

<p>드라마의 대표 커플은 당연히 정도전과 이성계일 것입니다. 그런데 이 규칙에서 그들이 보이지 않는 이유는.. 아마 두 등장인물간 대화도 많았겠지만, 타 인물들과의 관계도 못지 않았기 때문이지 않을까요? 예를 들어 정도전은 가족들, 이성계 일가들, 측근들, 정적들 등 거의 대부분의 인물들과도 함께 포착되었기에 support는 높을 수 있어도 lift는 낮을 수 있습니다. 결과절이 ‘정도전’인 것으로 규칙을 다시 뽑아봤습니다. </p>

<p><img src="/assets/jdj/pic5.png" alt="pic5">
<span class="caption text-muted">fig 4. rules with 정도전 on rhs</span>
<p>역시 리프트를 보면 앞선 규칙들과 달리 3을 넘지 못합니다. 즉 앞선 규칙들에 비해 힘이 약하다고 볼 수 있겠네요.</p>
<p>결과적으로 앞서 도출된 3쌍에 의미를 부여하자면, 직관적으로나 빈도상으로 파악했을때 가장 중요한 커플들은 아니었으나, 서로 가장 끈끈하게 관계를 유지했던 인물들로 이해할 수 있을 것 같습니다. 특히 이숭인과 권근, 임견미와 염흥방은 말이지요.</p></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span><span class="kn">library</span><span class="p">(</span>arules<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>arulesViz<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>wordcloud<span class="p">)</span>
file_list <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">()</span>

data_list <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">()</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">)</span> <span class="p">{</span>
  filename <span class="o">&lt;-</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;jdj&quot;</span><span class="p">,</span> i<span class="p">,</span> <span class="s">&quot;.csv&quot;</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
  <span class="kp">file</span><span class="o">&lt;-</span>read.csv<span class="p">(</span>filename<span class="p">,</span> header<span class="o">=</span><span class="bp">F</span><span class="p">,</span> stringsAsFactors<span class="o">=</span><span class="bp">F</span><span class="p">)</span>
  <span class="kp">file</span><span class="o">&lt;-</span><span class="kp">file</span><span class="p">[,</span> <span class="kp">colSums</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span><span class="kp">file</span><span class="p">))</span> <span class="o">!=</span> <span class="kp">nrow</span><span class="p">(</span><span class="kp">file</span><span class="p">)]</span>
  
  
  a_list <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">()</span>
  <span class="kr">for</span> <span class="p">(</span>row <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span><span class="kp">file</span><span class="p">))</span> <span class="p">{</span>
    temp <span class="o">&lt;-</span> <span class="kp">unlist</span><span class="p">(</span><span class="kp">file</span><span class="p">[</span><span class="kp">row</span><span class="p">,])</span>
    temp <span class="o">&lt;-</span> <span class="kp">as.vector</span><span class="p">(</span>temp<span class="p">)</span>
    temp2 <span class="o">&lt;-</span> <span class="kt">vector</span><span class="p">()</span>
    <span class="kr">for</span> <span class="p">(</span>item <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>temp<span class="p">))</span> <span class="p">{</span>
      <span class="kr">if</span> <span class="p">(</span>temp<span class="p">[</span>item<span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
        temp2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>temp2<span class="p">,</span> temp<span class="p">[</span>item<span class="p">])</span>
      <span class="p">}</span>
    <span class="p">}</span>
    a_list<span class="p">[[</span><span class="kp">row</span><span class="p">]]</span> <span class="o">&lt;-</span> temp2
    
  <span class="p">}</span>
  data_list <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>data_list<span class="p">,</span> a_list<span class="p">)</span>
  
<span class="p">}</span>

<span class="kp">names</span><span class="p">(</span>data_list<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;scene&quot;</span><span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>data_list<span class="p">)),</span> sep<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>

trans <span class="o">&lt;-</span> as<span class="p">(</span>data_list<span class="p">,</span> <span class="s">&quot;transactions&quot;</span><span class="p">)</span>

par<span class="p">(</span>family<span class="o">=</span><span class="s">&quot;AppleGothic&quot;</span><span class="p">)</span>
itemName <span class="o">&lt;-</span> itemLabels<span class="p">(</span>trans<span class="p">)</span>
itemCount <span class="o">&lt;-</span>itemFrequency<span class="p">(</span>trans<span class="p">)</span> <span class="o">*</span><span class="m">1766</span>
col <span class="o">&lt;-</span> brewer.pal<span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="s">&quot;Dark2&quot;</span><span class="p">)</span>

wordcloud<span class="p">(</span>words <span class="o">=</span> itemName<span class="p">,</span> freq<span class="o">=</span>itemCount<span class="p">,</span> min.freq<span class="o">=</span><span class="m">1</span><span class="p">,</span> scale<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="m">0.1</span><span class="p">),</span> col<span class="o">=</span><span class="kp">col</span><span class="p">,</span> random.order<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
itemFrequencyPlot<span class="p">(</span>trans<span class="p">,</span> support<span class="o">=</span><span class="m">0.05</span><span class="p">,</span> cex.names<span class="o">=</span><span class="m">0.8</span><span class="p">)</span>

rules <span class="o">&lt;-</span> apriori<span class="p">(</span>trans<span class="p">,</span> parameter<span class="o">=</span><span class="kt">list</span><span class="p">(</span>support<span class="o">=</span><span class="m">0.01</span><span class="p">,</span> confidence<span class="o">=</span><span class="m">0.5</span><span class="p">))</span>
inspect<span class="p">(</span><span class="kp">head</span><span class="p">(</span><span class="kp">sort</span><span class="p">(</span>rules<span class="p">,</span>by<span class="o">=</span><span class="s">&quot;lift&quot;</span><span class="p">),</span><span class="m">5</span><span class="p">))</span>
rules <span class="o">&lt;-</span> apriori<span class="p">(</span>trans<span class="p">,</span> parameter<span class="o">=</span><span class="kt">list</span><span class="p">(</span>support<span class="o">=</span><span class="m">0.01</span><span class="p">,</span> confidence<span class="o">=</span><span class="m">0.5</span><span class="p">),</span> appearance<span class="o">=</span><span class="kt">list</span><span class="p">(</span>rhs<span class="o">=</span><span class="s">&quot;정도전&quot;</span><span class="p">,</span> default<span class="o">=</span><span class="s">&quot;lhs&quot;</span><span class="p">))</span>

plot<span class="p">(</span>rules<span class="p">)</span>
plot<span class="p">(</span>rules<span class="p">,</span> method<span class="o">=</span><span class="s">&quot;grouped&quot;</span><span class="p">)</span></code></pre></figure>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=%EC%97%B0%EA%B4%80%EA%B7%9C%EC%B9%99+%EB%B6%84%EC%84%9D%EC%82%AC%EB%A1%80+-+%EB%8C%80%ED%95%98%EB%93%9C%EB%9D%BC%EB%A7%88+%EC%A0%95%EB%8F%84%EC%A0%84&amp;url=http://localhost:4000/r/2015/05/03/jdj-association-analysis"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4>Junsik Whang</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">Published <time datetime="2015-05-03 08:50">03 May 2015</time></p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span>Supported by</span></h5>
            <footer class="site-footer">
              <section class="poweredby">Proudly published with <a href="http://jekyllrb.com"> Jekyll</a></section>
              <a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> You should subscribe to my feed.</span></a>
              <div class="inner">
                <section class="copyright">All content copyright <a href="/">Junsik Whang</a> &copy; 2017<br>All rights reserved.</section>
              </div>
            </footer>
          </div>
        </div>
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/cA4aKEIPQrerBnp1yGHv_IMG_9534-3-2.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">jsideas</h1>
        <h2 class="blog-description">a novice's journey into data science
</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36651119-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
