<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>파이썬 초보 - pandas와 matplotlib을 활용한 간단 분석 part 2</title>
  <meta name="description" content="a novice's journey into data science
" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="canonical" href="http://localhost:4000/python/2015/08/11/histogram_tutorial_part2.html">

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
<!--  <link rel="stylesheet" href=""> -->
  <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
</head>

  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->

<a href="http://localhost:4000" class="logo-readium"><span class="logo" style="background-image: url(/assets/images/df_logo.jpg)"></span></a>

<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="article-image">
          <div class="post-image-image" style="background-image: url(/assets/python_pandas/header.png)">
            Article Image
          </div>
          <div class="post-meta">
            <h1 class="post-title">파이썬 초보 - pandas와 matplotlib을 활용한 간단 분석 part 2</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Junsik Whang</h4>
              on
              <time datetime="2015-08-11 05:34">11 Aug 2015</time>
              <!-- , tagged on <span class="post-tag-">, <a href="/tag/"></a></span> -->
            </div>
            <div style="text-align:center">
              <a href="#topofpage" class="topofpage"><i class="fa fa-angle-down"></i></a>
            </div>
          </div>
        </div>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>(이미지 출처: <a href="http://stackoverflow.com/questions/27446455/pandas-subplots-in-a-loop">stackoverflow</a>)
<h2>파이썬 초보 - pandas와 matplotlib을 활용한 간단 분석 part 2</h2>
<p><a href="http://jsideas.net/python/2015/08/10/histogram_tutorial.html">part 1</a>에 이은 pandas와 matplotlib을 활용한 간단 분석 두번째 파트입니다.</p>

<p>파트 1에서는 분석을 위한 파이썬 개발환경을 갖추고, ipython에서 pandas 라이브러리를 활용하여 간단하게 데이터를 만져봤습니다. 파트2에서는 앞서 다루지 않았던 몇가지 함수를 더 소개하고, matplotlib 라이브러리를 활용해 히스토그램과 박스플롯을 뽑아보겠습니다.</p></p>

<h3>파이썬 pandas 만져보기 2</h3>

<ul>
<li><p><code>data[&#39;Seoul&#39;] = &#39;in seoul&#39;</code> - 데이터에 새로운 컬럼을 추가합니다. 앞서 컬럼을 선택할 때 <code>data.hourly_wage</code>로 선택을 했는데, <code>data[&#39;hourly_wage&#39;]</code>로도 동일한 기능을 수행할 수 있습니다. 단, 새로운 컬럼을 만드는 경우, <code>.</code>이 아닌 <code>[컬럼명]</code>으로 할당해주어야 기존 데이터프레임에 추가가 됩니다. 여기서는 <code>Seoul</code>이라는 컬럼을 새로 만들고 <code>in seoul</code>이라는 문자열을 입력했습니다.</p></li>
<li><p>커스텀 함수 만들기 - 이번에는 간단한 함수를 정의하고 이를 사용해서 컬럼을 만들어보겠습니다. 먼저 함수명과 그것이 사용할 인자 x를 정의합니다. 함수 <code>more_than_6000</code>에 인자 <code>x</code>가 들어오면, if문이 발동되는데, 만약 x가 6000보다 클 경우 <code>1</code>을 반환하고, 그렇지 않을 경우 <code>0</code>을 반환하도록 합니다. 코드로 구현하면 아래와 같이 구성할 수 있습니다. ipython에서는 <code>:</code>을 입력하면 자동으로 줄바꿈과 들여쓰기가 되어 그대로 치면 됩니다.</p></li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="k">def</span> <span class="nf">more_than_6000</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">6000</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">1</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span></code></pre></figure>

<ul>
<li><code>data[&#39;more_than_6000&#39;] = data.hourly_wage.map(lambda x: more_than_6000(x))</code>
앞서 정의한 함수를 사용하여 새로운 컬럼을 뽑았습니다. 약간 식이 복잡한데, 큰 틀은 위에서 문자열을 넣었던 방식과 동일합니다. <code>map</code> 함수는 그 안의 시급 데이터를 하나하나 선택하며 원하는 함수를 쓸 수 있도록 해주는데, 여기서는 <code>lambda x</code>라는 anonymous function(이름 없는 함수)를 써서 각 시급 데이터에 <code>more_than_6000</code> 함수를 적용했습니다. <code>시급 컬럼의 각 데이터를 돌아가며 함수를 쓸껀데, 그 함수는 6000보다 크면 1이고 아니면 0이다</code>라는 문장이 있다면 <code>함수를 쓸껀데, 그 함수는..</code> 부분이 람다 오퍼레이터가 수행하는 부분입니다. (설명이 야매라 죄송합니다 ㅠ) 여튼 결과가 잘 나왔는지 확인해봅시다. <code>data[data.more_than_6000 == 1].describe()</code></li>
</ul>

<p><img src="/assets/python_pandas/6.png" alt="람다 오퍼레이터 적용 결과"></p>

<p>min값이 6100원인걸 보면 정상적으로 잘 뽑혔네요!</p>

<ul>
<li>마지막으로 <code>구</code>과 <code>6000원 이상</code> 시급을 새로운 데이터 프레임에 넣어 봅시다. <code>data2 = data[data.more_than_6000 == 1][[&#39;area1&#39;, &#39;hourly_wage&#39;]]</code>를 실행합시다. <code>data2</code>는 전체 데이터에서 6000원이 넘는 시급을 가진 행을 추출한 후, 그 행의 구(<code>area1</code>)과 시급(<code>hourly_wage</code>)를 추린 서브 셋입니다.</li>
</ul>

<p><img src="/assets/python_pandas/7.png" alt="서브셋의 info"></p>

<ul>
<li><code>data2.to_csv(&#39;data2.csv&#39;, index=False)</code>를 실행하여 csv 데이터로 뽑습니다. 여기서 index=False는 pandas DataFrame이 자동으로 부여하는 행번호를 출력하지 않겠다는 의미입니다. 잘 뽑혔는지 확인해봅시다.</li>
</ul>

<p><img src="/assets/python_pandas/8.png" alt="csv로 출력"></p>

<p>정상적으로 잘 뽑혔네요.</p>

<p><hr /></p>

<h3>스크립트화 및 ipython에서 돌려보기</h3>

<p>지금까지 만들었던 코드 중 필요한 부분을 뽑아 파이썬 스크립트로 만들고 이를 ipython에서 돌려봅니다.</p>

<ul>
<li>필요한 라이브러리 불러오기</li>
<li>csv 파일 불러와서 pandas 데이터프레임으로 저장하기</li>
<li>데이터 프레임 확인하기</li>
<li><code>more_than_6000</code> 함수 정의하기</li>
<li><code>more_than_6000</code> 열 추가하기</li>
<li>서브셋 만들기</li>
<li>csv 파일 출력하기</li>
</ul>

<p>지난 시간에 만들었던 빈 파일인 <code>test.py</code>를 열고 코드를 입력해봅시다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># pandas 라이브러리 불러오기</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="c1"># csv 파일 불러와서 pandas 데이터프레임으로 저장하기</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;convenient_store.csv&#39;</span><span class="p">)</span>

<span class="c1"># 데이터 프레임 확인하기</span>
<span class="k">print</span> <span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="k">print</span> <span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="k">print</span> <span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

<span class="c1"># `more than 6000` 함수 정의하기</span>
<span class="k">def</span> <span class="nf">more_than_6000</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">6000</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="c1"># &#39;more_than_6000&#39; 열 추가하기</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;more_than_6000&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hourly_wage</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">more_than_6000</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># &#39;서브셋 만들기&#39;</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">more_than_6000</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s1">&#39;area1&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly_wage&#39;</span><span class="p">]]</span>

<span class="c1"># csv 파일로 출력하기</span>
<span class="n">data2</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data2.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></figure>

<p>!주의! 위에 코드를 보시면 <code># -*- coding: utf-8 -*-</code>이라는 녀석이 붙어있습니다. 인코딩 기준을 utf-8으로 설정해주는 건데, 이 한줄을 넣지 않고 그냥 코드를 돌리게 되면 <code>SyntaxError: Non-ASCII character &#39;\xeb&#39; in file test.py on line 1, but no encoding declared; see http://python.org/dev/peps/pep-0263/ for details</code> 이런 괴랄한 오류가 뜹니다. 데이터가 한글로 되어있어서 이런 문제가 발생하는데 저 코드 한줄이면 문제가 일단(!) 해결됩니다.</p>

<p>ipython 환경에서 나오는 방법은 <code>control + D</code>를 눌러 y를 치면 됩니다. 다시 가상환경으로 돌아와서 <code>python test.py</code>를 실행해 방금 짠 스크립트를 돌려봅시다. </p>

<p><img src="/assets/python_pandas/10.png" alt="터미널에서 파이썬 스크립트 돌리기"></p>

<p>오류 없이 잘 돌아갑니다. 이번에는 같은 코드를 ipython 환경에서 돌려봅시다. ipython 환경에서 돌리는 장점 중 하나는 코드를 돌렸을 때 그 안에서 정의한 변수를 계속 활용할 수 있다는 점입니다. </p>

<ul>
<li><code>ipython</code> - ipython 실행</li>
<li><code>%run test.py</code> - 터미널과 달리 스크립트 파일을 돌릴때는 %run을 치고 파일명을 쳐줍니다.</li>
<li><code>data.head()</code></li>
</ul>

<p><img src="/assets/python_pandas/11.png" alt="ipython에서 파이썬 스크립트 돌리기"></p>

<p>역시 잘 돌아갔습니다. ipython에 데이터를 올려놨으니 이제 시각화를 돌려봅시다.</p>

<h3>파이썬 matplotlib 만져보기 2</h3>

<p><a href="http://matplotlib.org/">matplotlib</a> 라이브러리는 파이썬을 활용한 데이터 시각화에 자주 쓰이는 좋은 라이브러리입니다. 이 라이브러리를 활용해서 히스토그램, 박스플롯 같은 차트를 쉽고 빠르게 그릴 수 있습니다.</p>

<ul>
<li><code>import matplotlib.pyplot as plt</code> - matplotlib 라이브러리 중 pyplot이라는 모듈을 <code>plt</code>라는 이름으로 불러옵니다. (이름이 길어서..)</li>
<li><code>data.hourly_wage.hist(bins=10)</code> - 먼저 히스토그램을 그려봅시다. 전체 편의점 데이터의 시급을 히스토그램으로 그리는데, 구간은 10개 구간으로 정하겠습니다. 이 명령어를 입력하면 <code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1111dfc10&gt;</code> 이런 결과를 뱉는데, matplotlib 플롯을 만들어놨다는 얘깁니다. </li>
<li><code>plt.show()</code>를 돌려 그래프를 뽑아봅시다.</li>
</ul>

<p><img src="/assets/python_pandas/12.png" alt="matplotlib 히스토그램"></p>

<p>잘 뽑혔습니다. 위에 명령어에서 bins 값을 조정하거나, 조금 더 나아가서 여기서 다루지 않는 numpy의 linspace 함수를 쓰면 최소값, 최대값, 구간 수를 정해 더 정확한 구간을 가진 히스토그램을 뽑을 수 있습니다. <code>plot.show</code>를 치면 새로운 창이 열리면서 그래프가 뜨는데, 이 그래프 창을 꺼야만 ipython에서 다시 입력이 가능해집니다.</p>

<ul>
<li><code>data.boxplot(column=&#39;hourly_wage&#39;)</code> - 이번에는 같은 데이터를 박스플롯으로 표현해봅시다. <code>plt.show()</code>를 입력해 시각화된 차트를 띄웁니다.</li>
</ul>

<p><img src="/assets/python_pandas/13.png" alt="matplotlib 박스플롯"></p>

<ul>
<li><code>data.boxplot(column=&#39;hourly_wage&#39;, by=&#39;name&#39;)</code> - 이번에는 회사별로 박스플롯을 돌려봅시다. 데이터에 <code>name</code>이라는 컬럼에 회사명이 표시되어있습니다. 이를 <code>by=&#39;name&#39;</code>이라는 부분에 집어넣어 옵션으로 지정해주면 간단하게 박스플롯 3개가 한번에 그려집니다.</li>
</ul>

<p><img src="/assets/python_pandas/14.png" alt="회사별 박스플롯"></p>

<ul>
<li><code>data.boxplot(column=&#39;hourly_wage&#39;, by=&#39;area1&#39;)</code> - 같은 방식으로 구별 히스토그램을 뽑을 수 있습니다.</li>
</ul>

<p><img src="/assets/python_pandas/15.png" alt="회사별 박스플롯"></p>

<p>그런데 ipython에서 한글을 제대로 인식하지 못했네요 ㅠㅠ 내장된 폰트가 한글을 인식하지 못했기 때문인데 이 경우 한글 폰트를 지정해주면 됩니다. <code>plt.show()</code>를 치기 전에 <code>matplotlib.rc(&#39;font&#39;,family=&#39;AppleGothic&#39;)</code>으로 폰트를 지정해주면..</p>

<p><img src="/assets/python_pandas/16.png" alt="회사별 박스플롯(한글 수정)"></p>

<p>정상적으로 수정되어 박스플롯이 출력됩니다.</p>

<ul>
<li>이번에는 구별로 회사를 나누어 박스플롯으로 출력하는데, 세로가 아닌 가로로 플롯을 그려봅시다. <code>data.boxplot(column=&#39;hourly_wage&#39;, by=[&#39;area1&#39;, &#39;name&#39;], vert=False)</code>를 찍고, 폰트 지정을 해준 후 그래프를 출력합니다. <code>vert=False</code>는 박스플롯을 가로로 그리는 옵션입니다.</li>
</ul>

<p><img src="/assets/python_pandas/17.png" alt="구별 회사별 박스플롯"></p>

<p><hr /></p>

<h3>마치며</h3>

<p>파이썬의 pandas와 matplotlib 라이브러리를 활용해 csv 데이터를 불러온 후 기준에 따라 가공하고 히스토그램과 박스플롯으로 시각화해보았습니다. 각 라이브러리의 영문 홈페이지와 개발문서를 보면 본 튜토리얼에서 소개한 몇가지 함수 이외에도 굉장히 많은 유용한 함수가 소개되어있으니, 이를 통해 더 많은 새로운 차트를 그려보세요! 다음번에는 좀 덜 야매스러운 설명으로 튜토리얼을 구성해보겠습니다. 감사합니다!</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=%ED%8C%8C%EC%9D%B4%EC%8D%AC+%EC%B4%88%EB%B3%B4+-+pandas%EC%99%80+matplotlib%EC%9D%84+%ED%99%9C%EC%9A%A9%ED%95%9C+%EA%B0%84%EB%8B%A8+%EB%B6%84%EC%84%9D+part+2&amp;url=http://localhost:4000/python/2015/08/11/histogram_tutorial_part2"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4>Junsik Whang</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">Published <time datetime="2015-08-11 05:34">11 Aug 2015</time></p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span>Supported by</span></h5>
            <footer class="site-footer">
              <section class="poweredby">Proudly published with <a href="http://jekyllrb.com"> Jekyll</a></section>
              <a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> You should subscribe to my feed.</span></a>
              <div class="inner">
                <section class="copyright">All content copyright <a href="/">Junsik Whang</a> &copy; 2017<br>All rights reserved.</section>
              </div>
            </footer>
          </div>
        </div>
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/cA4aKEIPQrerBnp1yGHv_IMG_9534-3-2.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">jsideas</h1>
        <h2 class="blog-description">a novice's journey into data science
</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36651119-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
